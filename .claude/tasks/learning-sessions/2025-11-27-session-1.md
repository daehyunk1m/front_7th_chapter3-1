# 학습 세션 로그

## 세션 정보
| 항목 | 내용 |
|------|------|
| 날짜 | 2025-11-27 |
| 세션 번호 | 1 |
| 학습 주제 | FormInput 마이그레이션 + useValidation 필드별 에러 관리 |
| 진행 상태 | 완료 |

---

## 오늘의 학습 목표
- [x] FormInput 컴포넌트 shadcn/ui 마이그레이션
- [x] useValidation 훅 생성 및 필드별 에러 스코프 문제 해결
- [x] ManagementPage에 새 FormInput 적용

---

## Q&A 기록

### Q1: 레거시 FormInput의 문제점은?
**질문**: 레거시 FormInput이 가진 관심사 분리 문제는?

**답변**:
- UI 컴포넌트에 비즈니스 검증 로직이 포함됨 (`fieldType`, `entityType`, `checkBusinessRules`)
- 내부 상태(`internalError`)로 에러 관리 → 외부 제어 어려움
- validateField 함수에 예약어 체크, 회사 도메인 이메일, 금칙어 체크 등 비즈니스 로직 집중

### Q2: FormInput 아키텍처 설계
**질문**: 순수 Input을 감싸는 구조를 어떻게 설계해야 하나?

**답변**: 3레이어 아키텍처 적용
```
useValidation (훅 레이어)
  └─ validation 로직 + 에러 상태 관리
       └─ FormInput (비즈니스 레이어)
            └─ validate 상태에 따른 분기처리 (label, error 표시)
                 └─ Input (순수 UI 레이어)
                      └─ 스타일링만
```

### Q3: useValidation 에러 스코프 문제
**질문**: useValidation을 ManagementPage에서 사용하려 했는데, validation이 각 인풋별로 스코프가 잡혀야 하는데 모든 인풋에 에러가 표시됨

**답변**:
- **원인**: 단일 `internalError` 상태 → 모든 필드가 동일 에러 공유
- **해결**: `Record<string, string>` 자료구조로 필드별 에러 분리
```tsx
// Before
const [internalError, setInternalError] = useState("");

// After
const [validationError, setValidationError] = useState<Record<string, string>>({});
// { username: "3자 이상", email: "", title: "" }
```

### Q4: 자료구조 변경 vs 지역상태
**질문**: 자료구조 변경이 효율적일까, 지역상태로 만드는게 효율적일까?

**답변**:
| 항목 | 자료구조 변경 | 지역 상태 |
|------|--------------|----------|
| 관심사 분리 | ✅ 검증 로직이 훅에 집중 | ❌ FormInput이 entityType 알아야 함 |
| 폼 전체 검증 | ✅ 쉬움 | ❌ 어려움 (각 컴포넌트에서 수집 필요) |

→ 지역상태로 가면 FormInput이 다시 `entityType`을 알아야 해서 레거시와 동일해짐

---

## 학습한 개념

### 1. Input 관련 3레이어 아키텍처
```
useValidation.ts (훅)
  └─ validationError: Record<string, string>
  └─ validateField(value, name, fieldType)
       │
ManagementPage.tsx (페이지)
  └─ handleChange에서 validateField 호출
  └─ error={validationError.username} 필드별 전달
       │
FormInput.tsx (비즈니스 레이어)
  └─ label, error 표시, 레이아웃
       │
Input.tsx (순수 UI - shadcn/ui)
  └─ 스타일링만 (aria-invalid로 에러 스타일)
```

### 2. shadcn/ui Input의 순수 UI 특징
- 비즈니스 로직 0%
- `React.ComponentProps<"input">` - HTML 표준 속성만 받음
- `aria-invalid` 속성으로 에러 스타일만 적용

### 3. 필드별 에러 관리 패턴
```tsx
// validateField에서 name 파라미터로 필드 식별
validateField(newValue, name, fieldType);

// 필드별로 에러 전달
<FormInput error={validationError.username} />
<FormInput error={validationError.email} />
```

---

## 주요 코드 변경

### 새로 생성된 파일
| 파일 | 설명 |
|------|------|
| `components/ui/input.tsx` | shadcn/ui Input (순수 UI) |
| `components/forms/FormInput.tsx` | 비즈니스 레이어 (label, error 표시) |

### 수정된 파일
| 파일 | 변경 내용 |
|------|------|
| `hooks/useValidation.ts` | `Record<string, string>`로 필드별 에러 관리 |
| `pages/ManagementPage.tsx` | 새 FormInput 적용, handleChange에서 validateField 호출 |

---

## 커밋 로그

| 해시 | 메시지 |
|------|------|
| 7ffae3f | Refactor: FormInput 컴포넌트에서 비즈니스 로직 분리 및 스타일 개선 |

---

## 해결한 문제들

### 1. 모든 필드에 동일 에러 표시
- **문제**: 단일 `internalError` 상태로 인해 모든 FormInput에 같은 에러 표시
- **해결**: `Record<string, string>` 자료구조 + `name` 파라미터로 필드별 에러 분리

---

## PR/회고용 노트

### 잘한 점
- Table 3레이어 패턴을 Input에도 동일하게 적용
- 자료구조 선택 시 트레이드오프 분석 (중앙 집중 vs 지역 상태)
- shadcn/ui Input의 순수 UI 설계 원칙 이해

### 개선할 점
- useValidation에서 `setValidationError({ ...validationError, [name]: ... })` 패턴이 반복됨 → 헬퍼 함수로 추출 가능

### 학습 인사이트
- "필드별 스코프가 필요하면 Record<string, T>" 패턴
- 지역 상태로 해결하면 관심사가 다시 섞이는 문제 발생

---

## 다음 세션 계획

### 우선순위 높음
1. **FormSelect 컴포넌트 마이그레이션**
   - shadcn/ui Select 활용
   - FormInput과 동일한 레이어 구조 적용

### 우선순위 중간
2. **Modal 컴포넌트 마이그레이션**
   - shadcn/ui Dialog 활용
   - Radix UI 접근성 기능 활용

3. **Alert 컴포넌트 마이그레이션**

### 참고사항
- `_legacy` 폴더의 FormSelect, Modal, Alert이 아직 사용 중
- 마이그레이션 완료 후 `_legacy` 폴더 제거 예정
