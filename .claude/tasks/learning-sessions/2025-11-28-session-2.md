# 학습 세션 로그

## 세션 정보
| 항목 | 내용 |
|------|------|
| 날짜 | 2025-11-28 |
| 세션 번호 | 2 |
| 학습 주제 | CVA 패턴 완전 적용, Storybook 설정 및 Stories 작성, 최종 검증 |
| 진행 상태 | 완료 |

---

## 오늘의 학습 목표
- [x] 남은 컴포넌트에 CVA 패턴 적용 (Alert, Modal, FormInput, Table)
- [x] Storybook 설정 및 10개 컴포넌트 Stories 작성
- [x] ESLint 설정 개선 및 타입 안전성 강화
- [x] 최종 검증 (테스트, 빌드, 린트, Storybook 빌드)

---

## Q&A 기록

### Q1: Storybook의 render 함수에서 useState 사용 시 ESLint 에러
**질문**: Storybook story에서 `render` 함수 내에 `useState`를 사용하면 `react-hooks/rules-of-hooks` 에러 발생

**답변**:
- **원인**: ESLint가 `render` 함수를 React 컴포넌트로 인식하지 못함
- **해결**: ESLint 설정에서 Storybook 파일에 대한 별도 규칙 추가
```javascript
// eslint.config.js
{
  files: ['**/*.stories.tsx'],
  rules: {
    'react-hooks/rules-of-hooks': 'off',
  },
}
```

### Q2: StoryObj 타입에서 render만 사용 시 args 필수 에러
**질문**: `render` 함수만 사용하는 story에서 `args`가 필수라는 타입 에러 발생

**답변**:
- **원인**: `StoryObj<typeof meta>`는 `args`를 필수로 요구
- **해결**: `StoryObj<typeof Component>`로 변경하면 `args` 선택적
```tsx
// Before
type Story = StoryObj<typeof meta>;

// After
type Story = StoryObj<typeof Modal>;
```

### Q3: Table 컴포넌트의 any 타입 제거
**질문**: Table 컴포넌트에서 `Column.render`와 `data`에 `any` 타입 사용 중

**답변**:
- **해결**: 제네릭 타입 `<T>`를 도입하여 타입 안전성 확보
```tsx
export interface Column<T = Record<string, unknown>> {
  key: string;
  render?: (value: unknown, row: T) => React.ReactNode;
}

export const Table = <T extends Record<string, unknown>>({
  columns,
  data,
}: TableProps<T>) => { ... }
```

### Q4: useManagement 훅의 error 타입 처리
**질문**: `catch (error: any)`에서 any 제거 방법

**답변**:
- **해결**: `err instanceof Error` 패턴 사용
```tsx
// Before
} catch (error: any) {
  setErrorMessage(error.message || "실패했습니다");
}

// After
} catch (err) {
  const message = err instanceof Error ? err.message : "실패했습니다";
  setErrorMessage(message);
}
```

---

## 학습한 개념

### 1. ESLint Flat Config의 파일별 규칙 설정
```javascript
export default defineConfig([
  // 일반 파일 규칙
  {
    files: ['**/*.{ts,tsx}'],
    ignores: ['**/*.stories.tsx'],
    rules: { /* 엄격한 규칙 */ },
  },
  // Storybook 파일 완화된 규칙
  {
    files: ['**/*.stories.tsx'],
    rules: {
      'react-hooks/rules-of-hooks': 'off',
    },
  },
]);
```

### 2. TypeScript 제네릭 컴포넌트 패턴
```tsx
// 제네릭 타입을 사용한 재사용 가능한 테이블
export const Table = <T extends Record<string, unknown>>({
  columns,
  data,
}: TableProps<T>) => { ... }

// 사용 시 타입 추론
<Table
  columns={[{ key: 'name', header: 'Name' }]}
  data={[{ name: 'John' }]} // T는 { name: string }으로 추론
/>
```

### 3. 안전한 에러 핸들링 패턴
```tsx
try {
  await someAsyncOperation();
} catch (err) {
  // unknown 타입의 err를 안전하게 처리
  const message = err instanceof Error
    ? err.message
    : "알 수 없는 오류가 발생했습니다";
  setErrorMessage(message);
}
```

### 4. Storybook 10 + Vite 설정
- `@storybook/react-vite` 프레임워크 사용
- ESM 환경에서 `__dirname` 대신 `import.meta.url` 사용
- Tailwind CSS 적용을 위해 preview.ts에서 CSS import

---

## 주요 코드 변경

### 수정된 파일
| 파일 | 설명 |
|------|------|
| `eslint.config.js` | Storybook 파일 별도 규칙 + 미사용 변수 패턴 |
| `src/components/tables/Table.tsx` | 제네릭 타입 `<T>` 도입 |
| `src/hooks/useManagement.ts` | 타입 안전성 강화, useCallback 적용 |
| `src/stories/*.stories.tsx` | StoryObj 타입 수정 (6개 파일) |
| `../before/eslint.config.js` | 미사용 storybook import 제거 |

### 생성된 파일
| 파일 | 설명 |
|------|------|
| `src/stories/Button.stories.tsx` | Button 컴포넌트 Stories |
| `src/stories/Badge.stories.tsx` | Badge 컴포넌트 Stories |
| `src/stories/FormInput.stories.tsx` | FormInput 컴포넌트 Stories |
| `src/stories/FormSelect.stories.tsx` | FormSelect 컴포넌트 Stories |
| `src/stories/FormTextarea.stories.tsx` | FormTextarea 컴포넌트 Stories |
| `src/stories/FormCheckbox.stories.tsx` | FormCheckbox 컴포넌트 Stories |
| `src/stories/Card.stories.tsx` | Card 컴포넌트 Stories |
| `src/stories/Modal.stories.tsx` | Modal 컴포넌트 Stories |
| `src/stories/Alert.stories.tsx` | Alert 컴포넌트 Stories |
| `src/stories/Table.stories.tsx` | Table 컴포넌트 Stories |

---

## 해결한 문제들

### 1. Vitest와 Storybook 버전 충돌
- **문제**: `@vitest/browser-playwright` 4.x와 vitest 2.x 호환성 문제
- **해결**: vite.config.ts와 vitest.config.ts 분리

### 2. ESM 환경에서 __dirname 미정의
- **문제**: Storybook main.ts에서 `__dirname is not defined` 에러
- **해결**: `fileURLToPath(import.meta.url)` 사용
```typescript
import { fileURLToPath } from 'url';
const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);
```

### 3. Table Column 타입 export 문제
- **문제**: `Column` 타입을 named export하지 않음
- **해결**: `export interface Column<T>` 추가

### 4. before 패키지 ESLint 에러
- **문제**: `eslint-plugin-storybook` import하지만 설치되지 않음
- **해결**: 미사용 import 제거

---

## 최종 검증 결과

| 항목 | 결과 | 비고 |
|------|------|------|
| 테스트 | ✅ 통과 | 2개 테스트 |
| 빌드 | ✅ 성공 | 299.99 kB |
| 린트 | ✅ 에러 없음 | - |
| Storybook 빌드 | ✅ 성공 | 10개 컴포넌트 |

---

## 커밋 내역

| 해시 | 메시지 |
|------|--------|
| `ec76a90` | Fix: ESLint 설정 개선 및 타입 안전성 강화 |

---

## PR/회고용 노트

### 잘한 점
- CVA 패턴을 모든 컴포넌트에 일관되게 적용
- 제네릭 타입으로 Table 컴포넌트의 타입 안전성 확보
- ESLint 설정을 파일 유형별로 세분화하여 관리
- 10개 컴포넌트에 대한 포괄적인 Storybook Stories 작성

### 학습 인사이트
- "ESLint flat config는 파일별로 다른 규칙을 적용할 수 있어 유연하다"
- "제네릭 타입을 사용하면 any 없이도 유연한 컴포넌트를 만들 수 있다"
- "Storybook의 render 함수는 React 컴포넌트처럼 보이지만 ESLint는 그렇게 인식하지 않는다"
- "err instanceof Error 패턴은 unknown 타입의 에러를 안전하게 처리하는 표준 방법"

---

## 프로젝트 완료!

### 마이그레이션 완료된 컴포넌트 (10개)
- **UI**: Button, Badge
- **Forms**: FormInput, FormSelect, FormTextarea, FormCheckbox
- **Layout**: Card, Modal, Alert, Table

### 적용된 기술 스택
- TailwindCSS v4 + CVA (Class Variance Authority)
- shadcn/ui 컴포넌트 래핑 패턴
- Radix UI 프리미티브 (Dialog, Checkbox, Select)
- Storybook 10 + Vite
- TypeScript 제네릭 타입

### 다음 단계 제안
1. **README.md 작성** - 프로젝트 소개 및 Before/After 비교
2. **테스트 보강** - 각 컴포넌트 단위 테스트 추가
3. **접근성 검증** - Storybook a11y 애드온 활용
4. **성능 최적화** - 번들 사이즈 분석 및 최적화
